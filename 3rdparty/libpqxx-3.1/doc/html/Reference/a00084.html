<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>libpqxx: pqxx::robusttransaction&lt; ISOLATIONLEVEL &gt; Class Template Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="a00171.html">pqxx</a>::<a class="el" href="a00084.html">robusttransaction</a>
  </div>
</div>
<div class="contents">
<h1>pqxx::robusttransaction&lt; ISOLATIONLEVEL &gt; Class Template Reference<br>
<small>
[<a class="el" href="a00199.html">Transaction classes</a>]</small>
</h1><!-- doxytag: class="pqxx::robusttransaction" --><!-- doxytag: inherits="pqxx::basic_robusttransaction" -->Slightly slower, better-fortified version of <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a>.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="a00243.html">robusttransaction.hxx</a>&gt;</code>
<p>
<div class="dynheader">
Inheritance diagram for pqxx::robusttransaction&lt; ISOLATIONLEVEL &gt;:</div>
<div class="dynsection">
<p><center><img src="a00621.png" border="0" usemap="#a00622" alt="Inheritance graph"></center>
<map name="a00622">
<area shape="rect" href="a00008.html" title="pqxx::basic_robusttransaction" alt="" coords="53,238,264,265"><area shape="rect" href="a00025.html" title="pqxx::dbtransaction" alt="" coords="85,161,232,188"><area shape="rect" href="a00105.html" title="pqxx::transaction_base" alt="" coords="75,84,243,110"><area shape="rect" href="a00053.html" title="pqxx::internal::namedclass" alt="" coords="63,6,255,33"></map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center></div>

<p>
<a href="a00623.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="a00048.html">isolation_traits</a><br>
&lt; ISOLATIONLEVEL &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00084.html#8fb228809bd42b2936ada9f9573d30d6">isolation_tag</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Isolation level is read_committed by default.  <a href="#8fb228809bd42b2936ada9f9573d30d6"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00084.html#e28452f4e178b6c548f6294fee803632">robusttransaction</a> (<a class="el" href="a00020.html">connection_base</a> &amp;C, const std::string &amp;Name=std::string())</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor.  <a href="#e28452f4e178b6c548f6294fee803632"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00084.html#f1b175fd37479937c936f172803f40bb">~robusttransaction</a> ()  throw ()</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
<h3>template&lt;isolation_level ISOLATIONLEVEL = read_committed&gt;<br>
 class pqxx::robusttransaction&lt; ISOLATIONLEVEL &gt;</h3>

Slightly slower, better-fortified version of <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a>. 
<p>
<a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> is similar to <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a>, but spends more effort (and performance!) to deal with the hopefully rare case that the connection to the backend is lost just as the current <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> is being committed. In this case, there is no way to determine whether the backend managed to commit the <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> before noticing the loss of connection.<p>
In such cases, this class tries to reconnect to the database and figure out what happened. It will need to store and manage some information (pretty much a user-level <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> log) in the back-end for each and every <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> just on the off chance that this problem might occur. This service level was made optional since you may not want to pay this overhead where it is not necessary. Certainly the use of this class makes no sense for local connections, or for transactions that read the database but never modify it, or for noncritical database manipulations.<p>
Besides being slower, it's theoretically possible that <a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> actually fails more instead of less often than a normal <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a>. This is due to the added work and complexity. What <a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> tries to achieve is to be more deterministic, not more successful per se.<p>
When a user first uses a <a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> in a database, the class will attempt to create a log table there to keep vital transaction-related state information in. This table, located in that same database, will be called pqxxlog_*user*, where *user* is the PostgreSQL username for that user. If the log table can not be created, the <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> fails immediately.<p>
If the user does not have permission to create the log table, the database administrator may create one for him beforehand, and give ownership (or at least full insert/update rights) to the user. The table must contain two non-unique fields (which will never be null): "name" (of text type, <code>varchar(256)</code> by default) and "date" (of <code>timestamp</code> type). Older versions of <a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> also added a unique "id" field; this field is now obsolete and the log table's implicit oids are used instead. The log tables' names may be made configurable in a future version of libpqxx.<p>
The <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> log table contains records describing unfinished transactions, i.e. ones that have been started but not, as far as the client knows, committed or aborted. This can mean any of the following:<p>
<ol>
<li>
The <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> is in progress. Since backend transactions can't run for extended periods of time, this can only be the case if the log record's timestamp (compared to the server's clock) is not very old, provided of course that the server's system clock hasn't just made a radical jump. </li>
<li>
The client's connection to the server was lost, just when the client was committing the <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a>, and the client so far has not been able to re-establish the connection to verify whether the <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> was actually completed or rolled back by the server. This is a serious (and luckily a rare) condition and requires manual inspection of the database to determine what happened. The <a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> will emit clear and specific warnings to this effect, and will identify the log record describing the <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> in question. </li>
<li>
The <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> was completed (either by commit or by rollback), but the client's connection was durably lost just as it tried to clean up the log record. Again, <a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> will emit a clear and specific warning to tell you about this and request that the record be deleted as soon as possible. </li>
<li>
The client has gone offline at any time while in one of the preceding states. This also requires manual intervention, but the client obviously is not able to issue a warning. </li>
</ol>
<p>
It is safe to drop a log table when it is not in use (ie., it is empty or all records in it represent states 2-4 above). Each <a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> will attempt to recreate the table at its next time of use. <hr><h2>Member Typedef Documentation</h2>
<a class="anchor" name="8fb228809bd42b2936ada9f9573d30d6"></a><!-- doxytag: member="pqxx::robusttransaction::isolation_tag" ref="8fb228809bd42b2936ada9f9573d30d6" args="" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;isolation_level ISOLATIONLEVEL = read_committed&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="a00048.html">isolation_traits</a>&lt;ISOLATIONLEVEL&gt; <a class="el" href="a00084.html">pqxx::robusttransaction</a>&lt; ISOLATIONLEVEL &gt;::<a class="el" href="a00048.html">isolation_tag</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Isolation level is read_committed by default. 
<p>

<p>Reimplemented from <a class="el" href="a00008.html#ad0757a015b2ddfe476e3d83f812bbff">pqxx::basic_robusttransaction</a>.</p>

</div>
</div><p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="e28452f4e178b6c548f6294fee803632"></a><!-- doxytag: member="pqxx::robusttransaction::robusttransaction" ref="e28452f4e178b6c548f6294fee803632" args="(connection_base &amp;C, const std::string &amp;Name=std::string())" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;isolation_level ISOLATIONLEVEL = read_committed&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00084.html">pqxx::robusttransaction</a>&lt; ISOLATIONLEVEL &gt;::<a class="el" href="a00084.html">robusttransaction</a>           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00020.html">connection_base</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>C</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>Name</em> = <code>std&nbsp;::string()</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [explicit]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constructor. 
<p>
Creates <a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> of given name <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>C</em>&nbsp;</td><td>Connection that this <a class="el" href="a00084.html" title="Slightly slower, better-fortified version of transaction.">robusttransaction</a> should live inside. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Name</em>&nbsp;</td><td>optional human-readable name for this <a class="el" href="a00104.html" title="Standard back-end transaction, templatized on isolation level.">transaction</a> </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="f1b175fd37479937c936f172803f40bb"></a><!-- doxytag: member="pqxx::robusttransaction::~robusttransaction" ref="f1b175fd37479937c936f172803f40bb" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;isolation_level ISOLATIONLEVEL = read_committed&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="a00084.html">pqxx::robusttransaction</a>&lt; ISOLATIONLEVEL &gt;::~<a class="el" href="a00084.html">robusttransaction</a>           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">  throw ()<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="a00243.html">robusttransaction.hxx</a></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Feb 15 18:22:53 2010 for libpqxx by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
